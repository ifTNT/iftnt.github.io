var xhr,Home=location.href,Pages=4,xhrUrl="",Diaspora={L:function(e,t,a){if(e==xhrUrl)return!1;xhrUrl=e,xhr&&xhr.abort(),xhr=$.ajax({type:"GET",url:e,timeout:1e4,success:function(e){t(e),setTimeout(()=>{MathJax.Hub.Queue(["Typeset",MathJax.Hub])},100),xhrUrl=""},error:function(t,o,i){"abort"==o?a&&a():window.location.href=e,xhrUrl=""}})},P:function(){return!!("ontouchstart"in window)},PS:function(){window.history&&history.pushState&&(history.replaceState({u:Home,t:document.title},document.title,Home),window.addEventListener("popstate",function(e){var t=e.state;t&&(document.title=t.t,t.u==Home?($("#preview").css("position","fixed"),setTimeout(function(){$("#preview").removeClass("show"),$("#container").show(),window.scrollTo(0,parseInt($("#container").data("scroll"))),setTimeout(function(){$("#preview").html(""),$(window).trigger("resize")},300)},0)):(Diaspora.loading(),Diaspora.L(t.u,function(e){document.title=t.t,$("#preview").html($(e).filter("#single")),Diaspora.preview(),setTimeout(function(){Diaspora.player()},0)})))}))},HS:function(e,t){var a=e.data("id")||0,o=e.attr("href"),i=e.attr("title")||e.text();$("#preview").length&&window.history&&history.pushState||(location.href=o),Diaspora.loading();var n={d:a,t:i,u:o};Diaspora.L(o,function(e){if($(e).filter("#single").length){switch(t){case"push":history.pushState(n,i,o);break;case"replace":history.replaceState(n,i,o)}switch(document.title=i,$("#preview").html($(e).filter("#single")),t){case"push":Diaspora.preview();break;case"replace":window.scrollTo(0,0),Diaspora.loaded()}setTimeout(function(){Diaspora.player(),$("#top").show(),comment=$("#gitalk-container"),1==comment.data("ae")&&comment.click()},0)}else location.href=o})},preview:function(){$("#preview").one("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",function(){$("#preview").hasClass("show")?$("#container").hide():$("#container").show(),Diaspora.loaded()}),setTimeout(function(){$("#preview").addClass("show"),$("#container").data("scroll",window.scrollY),setTimeout(function(){$("#preview").css({position:"static","overflow-y":"auto"})},500)},0)},player:function(){var e=$("#audio");e.length?(""==$("#audio source").eq(0).attr("src")&&""==e[0].src&&(audiolist=$("#audio-list li"),mp3=audiolist.eq([Math.floor(Math.random()*audiolist.size())]),e[0].src=mp3.data("url")),1==e.eq(0).data("autoplay")&&e[0].play(),e.on({timeupdate:function(){var t=e[0].currentTime/e[0].duration*100;$(".bar").css("width",t+"%"),e[0].volume=t/5<=1?t/5:1},ended:function(){$(".icon-pause").removeClass("icon-pause").addClass("icon-play")},playing:function(){$(".icon-play").removeClass("icon-play").addClass("icon-pause")}})):$(".icon-play").css({color:"#dedede",cursor:"not-allowed"})},loading:function(){var e=window.innerWidth,t='<style class="loaderstyle" id="loaderstyle'+e+'">@-moz-keyframes loader'+e+"{100%{background-position:"+e+"px 0}}@-webkit-keyframes loader"+e+"{100%{background-position:"+e+"px 0}}.loader"+e+"{-webkit-animation:loader"+e+" 3s linear infinite;-moz-animation:loader"+e+" 3s linear infinite;}</style>";$(".loaderstyle").remove(),$("head").append(t),$("#loader").removeClass().addClass("loader"+e).show()},loaded:function(){$("#loader").removeClass().hide()},F:function(e,t,a){var o=$(e).parent().height(),i=$(e).parent().width(),n=a/t;o/i>n?(e.style.height=o+"px",e.style.width=o/n+"px"):(e.style.width=i+"px",e.style.height=i*n+"px"),e.style.left=(i-parseInt(e.style.width))/2+"px",e.style.top=(o-parseInt(e.style.height))/2+"px"}};$(function(){if(Diaspora.P()&&$("body").addClass("touch"),$("#preview").length){var e,t={};t.t=$("#cover"),t.w=t.t.attr("width"),t.h=t.t.attr("height"),(t.o=function(){$("#mark").height(window.innerHeight)})(),t.t.prop("complete")&&setTimeout(function(){t.t.load()},0),t.t.on("load",function(){(t.f=function(){var e,a,o,i,n=$("#mark").width(),r=$("#mark").height();i=n>=1e3||r>=1e3?1e3:500,n>=r?(a=o=n/i*50,e=o*n/r):(e=o=r/i*50,a=o*r/n),$(".layer").css({width:n+e,height:r+a,marginLeft:-.5*e,marginTop:-.5*a}),t.w||(t.w=t.t.width(),t.h=t.t.height()),Diaspora.F($("#cover")[0],t.w,t.h)})(),setTimeout(function(){$("html, body").removeClass("loading")},1e3),$("#mark").parallax();var e=new Vibrant(t.t[0]).swatches();e.DarkVibrant&&($("#vibrant polygon").css("fill",e.DarkVibrant.getHex()),$("#vibrant div").css("background-color",e.DarkVibrant.getHex())),e.Vibrant&&$(".icon-menu").css("color",e.Vibrant.getHex())}),t.t.attr("src")||alert("Please set the post thumbnail"),$("#preview").css("min-height",window.innerHeight),Diaspora.PS(),$(".pview a").addClass("pviewa"),$(window).on("resize",function(){clearTimeout(e),e=setTimeout(function(){Diaspora.P()||location.href!=Home||(t.o(),t.f()),$("#loader").attr("class")&&Diaspora.loading()},500)})}else $("#single").css("min-height",window.innerHeight),setTimeout(function(){$("html, body").removeClass("loading")},1e3),window.addEventListener("popstate",function(e){e.state&&(location.href=e.state.u)}),Diaspora.player(),$(".icon-icon, .image-icon").attr("href","/"),$("#top").show();$(window).on("scroll",function(){if($(".scrollbar").length&&!Diaspora.P()&&!$(".icon-images").hasClass("active")){var e=$(window).scrollTop(),t=$("#top").width()/(document.body.scrollHeight-$(window).height())*e;$(".scrollbar").width(t),e>80&&window.innerWidth>800?$(".subtitle").fadeIn():$(".subtitle").fadeOut()}}),$(window).on("touchmove",function(e){$("body").hasClass("mu")&&e.preventDefault()}),$("body").on("click",function(e){var t=$(e.target).attr("class")||"",a=$(e.target).attr("rel")||"";if("IMG"==e.target.nodeName&&"P"==$(e.target).parent().get(0).nodeName&&(t="pimg"),t||a)switch(!0){case-1!=t.indexOf("switchmenu"):window.scrollTo(0,0),$("html, body").toggleClass("mu");break;case-1!=t.indexOf("more"):if("loading"==(t=$(".more")).data("status"))return!1;var o=parseInt(t.data("page"))||1;if(1==o&&t.data("page",1),o>=Pages)return;return t.html("載入中...").data("status","loading"),Diaspora.loading(),Diaspora.L(t.attr("href"),function(e){var a=$(e).find(".more").attr("href");void 0!=a?(t.attr("href",a).html("載入更多").data("status","loaded"),t.data("page",parseInt(t.data("page"))+1)):$("#pager").remove(),MathJax.Hub.Queue(["Typeset",MathJax.Hub]);var o=$(window).scrollTop();$("#primary").append($(e).find(".post")),$(window).scrollTop(o+100),Diaspora.loaded(),$("html,body").animate({scrollTop:o+400},500)},function(){t.html("載入更多").data("status","loaded")}),!1;case-1!=t.indexOf("icon-home"):$(".toc").fadeOut(100),$("#preview").hasClass("show")?history.back():location.href="/";break;case-1!=t.indexOf("icon-scan"):$(".icon-scan").hasClass("tg")?$("#qr").toggle():($(".icon-scan").addClass("tg"),$("#qr").qrcode({width:128,height:128,text:location.href}).toggle());break;case-1!=t.indexOf("icon-play"):$("#audio")[0].play(),$(".icon-play").removeClass("icon-play").addClass("icon-pause");break;case-1!=t.indexOf("icon-pause"):$("#audio")[0].pause(),$(".icon-pause").removeClass("icon-pause").addClass("icon-play");break;case-1!=t.indexOf("cover"):return Diaspora.HS($(e.target).parent(),"push"),!1;case-1!=t.indexOf("posttitle"):return Diaspora.HS($(e.target),"push"),!1;case"prev"==a||"next"==a:if("prev"==a)var i=$("#prev_next a")[0].text;else i=$("#prev_next a")[1].text;return $(e.target).attr("title",i),Diaspora.HS($(e.target),"replace"),!1;case-1!=t.indexOf("toc-text")||-1!=t.indexOf("toc-link")||-1!=t.indexOf("toc-number"):return hash="","SPAN"==e.target.nodeName?hash=$(e.target).parent().attr("href"):hash=$(e.target).attr("href"),to=$("a.headerlink[href='"+hash+"']"),$("html,body").animate({scrollTop:to.offset().top-50},300),!1;case-1!=t.indexOf("pviewa"):return $("body").removeClass("mu"),setTimeout(function(){Diaspora.HS($(e.target),"push"),$(".toc").fadeIn(1e3)},300),!1;case-1!=t.indexOf("pimg"):var n=$(".pswp").get(0);if(n){var r=[],s=0,l=[];$(".content img").each(function(t,a){e.target.src==a.src&&(s=t);var o={src:a.src,w:a.naturalWidth,h:a.naturalHeight};l.push(a),r.push(o)}),new PhotoSwipe(n,PhotoSwipeUI_Default,r,{index:s,shareEl:!1,zoomEl:!1,allowRotationOnUserZoom:!0,history:!1,getThumbBoundsFn:function(e){var t=l[e],a=window.pageYOffset||document.documentElement.scrollTop,o=t.getBoundingClientRect();return{x:o.left,y:o.top+a,w:o.width}}}).init()}return!1;case-1!=t.indexOf("comment"):return Diaspora.loading(),comment=$("#gitalk-container"),gitalk=new Gitalk({clientID:comment.data("ci"),clientSecret:comment.data("cs"),repo:comment.data("r"),owner:comment.data("o"),admin:comment.data("a"),id:decodeURI(window.location.pathname),distractionFreeMode:comment.data("d")}),$(".comment").removeClass("link"),gitalk.render("gitalk-container"),Diaspora.loaded(),!1;default:return!0}}),comment=$("#gitalk-container"),1==comment.data("ae")&&comment.click(),console.log("%c Github %c","background:#24272A; color:#ffffff","","https://github.com/Fechin/hexo-theme-diaspora")});